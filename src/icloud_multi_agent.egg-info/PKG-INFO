Metadata-Version: 2.4
Name: icloud-multi-agent
Version: 0.3.2
Summary: Mock multi-agent helper for exploring iCloud backup download workflows
Author: OpenAI Codex
Requires-Python: >=3.11
Description-Content-Type: text/markdown
Requires-Dist: icloudpy>=0.7.0

# iCloud Multi-Agent Helper

This repository hosts a reference implementation of the multi-agent architecture described in
`agents.md`. It demonstrates how independent agents collaborate to authenticate, discover iCloud
backups, plan downloads, copy data, and produce verification reports. When private endpoints are
allowed the tool now queries Apple's (undocumented) backup listing endpoint via `icloudpy`, so your
**gerÃ§ek iCloud cihaz yedekleri** appear in the GUI/CLI. If the cloud API cannot be reached the
agents gracefully fall back to Finder/iTunes MobileSync folders or bundled mock data.

> âš ï¸ **Important:** Apple does not provide a supported public API for downloading full iCloud device
> backups. Listing them requires granting the tool access to private endpoints after signing in with
> your Apple ID and completing 2FA. **Downloading** those cloud snapshots is still intentionally
> blockedâ€”only local Finder/iTunes (MobileSync) backups can be copied. Proceed at your own risk and
> respect the platform's terms of service.

---

## ğŸš€ Quick Start

**Ä°lk kez mi kullanÄ±yorsunuz?** â†’ [QUICKSTART.md](QUICKSTART.md) dosyasÄ±nÄ± okuyun!

macOS kullanÄ±cÄ±larÄ± iÃ§in en kolay yol:
```bash
./macos-launcher.command  # Ã‡ift tÄ±klayÄ±n veya Terminal'den Ã§alÄ±ÅŸtÄ±rÄ±n
```

---

## Getting Started

1. Ensure Python 3.11+ is available.
2. Install the project in editable mode (optional):

   ```bash
   pip install -e .
   ```

3. Inspect the mock dataset in `data/mock_icloud.json`.
4. (Optional) Prepare Finder/iTunes MobileSync backups or ensure your iCloud account has active
   device backups.
5. Run the CLI:

   ```bash
   python -m icloud_multi_agent.cli --help
   ```

6. Launch the GUI (optional):

   ```bash
   python -m icloud_multi_agent.gui
   ```

   The window lets you configure whether private endpoints are allowed, browse to a mock data
   source, authenticate with your Apple ID/2FA code, refresh the backup list, and trigger downloads
   into a local directory.

## macOS One-Click Launcher

For macOS users the repository ships with `macos-launcher.command`. Double-clicking this file from
Finder (or running `open macos-launcher.command` from Terminal) will:

1. Verify that you are on macOS and locate `python3` (3.11+).
2. Create a dedicated virtual environment under `.venv_macos/` on the first run.
3. **Intelligently** install or update dependencies only when needed (checks version first).
4. Start the Tkinter GUI once setup completes.

### Launcher Features

- **âš¡ Fast startup:** Skips installation if already up to date
- **ğŸ”„ Auto-update:** Detects version mismatches and updates automatically
- **â±ï¸ Timeout protection:** 60s for pip upgrade, 120s for dependencies
- **ğŸ› Verbose mode:** Run with `VERBOSE=1 ./macos-launcher.command` to see detailed output
- **ğŸ’ª Error handling:** Clear messages if internet connection or installation fails

### Troubleshooting Launcher

**Stuck at "Updating dependencies"?**
- First run takes 30-60 seconds to download `icloudpy` and dependencies
- Check your internet connection
- Run with verbose mode: `VERBOSE=1 ./macos-launcher.command` to see what's happening
- If it times out (>120s), check your network or try again later

**Still having issues?**
```bash
# Clean start: Remove virtual environment and try again
rm -rf .venv_macos
./macos-launcher.command
```

If `python3` cannot be found the launcher prints guidance for installing it from python.org. You can
pass additional arguments to the GUI (for example, `--allow-private`) by editing the command to call
`open macos-launcher.command --args --allow-private`. The script keeps the Terminal window open at
the end so you can review any messages or errors before closing.

## Example Workflow

```bash
# Authenticate (stores session metadata under ~/.icloud_session.json)
python -m icloud_multi_agent.cli --allow-private \
  auth-login --apple-id user@example.com --password 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢' --code 000000

# List available backups. When private endpoints are enabled the command first attempts to
# contact Apple's backup service. Real iCloud snapshots will be listed alongside any local
# Finder/iTunes (MobileSync) backups. You can refresh the session inline by supplying the
# same Apple ID credentials.
python -m icloud_multi_agent.cli --allow-private \
  backup-list --apple-id user@example.com --password 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢' --code 000000

# Download the chosen backup into ./outputs/icloud_backups
python -m icloud_multi_agent.cli --allow-private \
  backup-download --id demo-backup \
  --apple-id user@example.com --password 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢' --code 000000
```

> â— **Cloud snapshots cannot be downloaded yet.** If you select an identifier that originates from
> the cloud API the CLI/GUI will stop and explain that only MobileSync folders are supported for
> copying. This keeps the project in line with Apple's published tooling while still letting you see
> which backups exist in iCloud.

The download command will produce:

- A copied folder structure under `outputs/icloud_backups`.
- Integrity logs in `outputs/logs/session.jsonl`.
- A JSON report in `outputs/icloud_backups/reports`.

On macOS the MobileSync directory is protected by "Full Disk Access". If you see a
`PermissionError` while listing backups, grant the Python interpreter access under **System
Settings â†’ Privacy & Security â†’ Full Disk Access** or copy the backups to a directory you control.

If your MobileSync backups live in a non-standard directory you can point the CLI at additional
locations using repeated `--mobile-sync-dir` flags:

```bash
python -m icloud_multi_agent.cli --allow-private \
  --mobile-sync-dir "D:/Backups/MobileSync" \
  backup-list
```

## SÄ±k KarÅŸÄ±laÅŸÄ±lan Sorunlar ve Ã‡Ã¶zÃ¼mleri

### âŒ Backup'larÄ±mÄ± gÃ¶remiyorum!

**Sorun:** GUI veya CLI'da yalnÄ±zca mock veriler (Ã¶rn. "iPhone 13" demo backup) gÃ¶rÃ¼nÃ¼yor, gerÃ§ek iCloud yedeklerim listelenmiyor.

**Ã‡Ã¶zÃ¼mler:**

1. **"Ã–zel uÃ§ noktalara izin ver" seÃ§eneÄŸini aktifleÅŸtirin:**
   - **GUI'de:** "Ã–zel uÃ§ noktalara izin ver (riskli)" checkbox'Ä±nÄ± iÅŸaretleyin
   - **CLI'de:** `--allow-private` bayraÄŸÄ±nÄ± ekleyin

2. **Apple ID ile giriÅŸ yapÄ±n:**
   ```bash
   # CLI iÃ§in:
   python -m icloud_multi_agent.cli --allow-private auth-login --apple-id sizin@email.com
   
   # GUI iÃ§in:
   Apple ID ve parolanÄ±zÄ± girin â†’ "GÃ¶nder" butonuna tÄ±klayÄ±n â†’ 2FA kodunu girin
   ```

3. **GiriÅŸ yaptÄ±ktan sonra backup listesini yenileyin:**
   - GUI'de artÄ±k otomatik yenileniyor âœ…
   - CLI'de tekrar `backup-list` komutunu Ã§alÄ±ÅŸtÄ±rÄ±n

4. **USB Ã¼zerinden yerel backup'lar iÃ§in:**
   - iOS cihazÄ±nÄ±zÄ± Mac/PC'ye baÄŸlayÄ±n
   - Finder (macOS) veya iTunes (Windows) ile yedekleme yapÄ±n
   - macOS'ta "Tam Disk EriÅŸimi" iznini Python'a verin

### âš ï¸ "Politika gereÄŸi devre dÄ±ÅŸÄ±" hatasÄ±

Bu hata, gÃ¼venlik nedeniyle Ã¶zel uÃ§ noktalara eriÅŸimin kapalÄ± olduÄŸunu gÃ¶sterir.

**Ã‡Ã¶zÃ¼m:** `--allow-private` bayraÄŸÄ±nÄ± kullanÄ±n veya GUI'de checkbox'Ä± iÅŸaretleyin.

### ğŸ” 2FA kodu isteniyor

Apple hesaplarÄ±nÄ±z 2FA ile korunuyorsa (ki korunmalÄ±!), giriÅŸ yaparken size gÃ¶nderilen 6 haneli kodu girmeniz gerekir.

**CLI:**
```bash
python -m icloud_multi_agent.cli --allow-private auth-login \
  --apple-id sizin@email.com --code 123456
```

**GUI:**
1. Apple ID ve parola girin â†’ "GÃ¶nder"
2. iPhone/iPad'inizde beliren kodu gÃ¶receksiniz
3. Kodu "2FA Kodu" alanÄ±na yazÄ±n â†’ "2FA DoÄŸrula"

### ğŸ“± MobileSync izin hatasÄ± (macOS)

```
PermissionError: MobileSync yedek klasÃ¶rÃ¼ne eriÅŸim izni bulunamadÄ±
```

**Ã‡Ã¶zÃ¼m:**
1. **Sistem AyarlarÄ±** â†’ **Gizlilik ve GÃ¼venlik** â†’ **Tam Disk EriÅŸimi**
2. Python veya Terminal'e izin verin
3. UygulamayÄ± yeniden baÅŸlatÄ±n

Veya yedekleri eriÅŸilebilir bir klasÃ¶re kopyalayÄ±p Ã¶zel dizin belirtin:
```bash
python -m icloud_multi_agent.cli --allow-private \
  --mobile-sync-dir "/Users/sizin_isim/Desktop/Backups" backup-list
```

## Extending to Real Sources

- The `CloudBackupICloudAPI` adapter relies on icloudpy to talk to Apple's private backup listing
  endpoint. Oturum aÃ§Ä±ldÄ±ktan sonra hangi MobileBackup URL'si dÃ¶nerse dÃ¶nsÃ¼n otomatik olarak onu
  hedefler. Ä°ndirme tarafÄ± hÃ¢lÃ¢ devre dÄ±ÅŸÄ±, ancak `agents/icloud_api_agent.py` iÃ§indeki analiz
  kodunu inceleyerek yeni veri kaynaklarÄ±yla deney yapabilirsiniz.
- The `MobileSyncICloudAPI` adapter enumerates Finder/iTunes USB backups when private endpoints
  are allowed. You can add additional adapters (for example, to integrate with approved cloud
  storage) by following the same pattern.
- Implement stronger verification in `HashVerifier`, e.g. by comparing to manifest hashes.
- Extend the CLI/GUI to integrate with additional storage providers or richer verification flows.
